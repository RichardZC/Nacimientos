@model IEnumerable<BE.caja>

@{
    var listaUsuario = BL.UsuarioBL.ListarUsuariosSinCaja();
    //var boveda = BL.CajadiarioBL.getBoveda();
}

<div class="row">
    <div class="col s12 m12 l12">
        <div class="card-panel">
            <div class="row">
                <form class="col s12">
                    <h4 class="header2">Asignación de cajeros</h4>
                    <div class="row">

                        <table class="striped">
                            <thead>
                                <tr>
                                    <th data-field="id">Caja</th>
                                    <th data-field="name">Estado</th>
                                    <th data-field="price">Usuario</th>
                                    <th data-field="price">Fecha Inic. Op.</th>
                                </tr>
                            </thead>

                            <tbody>
                                @foreach (var item in Model)
                                {

                                    <tr>

                                        <td>
                                            @item.Denominacion
                                        </td>
                                        <td id="estado_@item.CajaId">
                                            @if (item.IndAbierto)
                                            {
                                                <text>Abierto</text>
                                            }
                                            else
                                            {
                                                <text>Cerrado</text>
                                            }
                                        </td>
                                        <td id="persona_@item.CajaId">
                                            @if (item.IndAbierto)
                                            {
                                                @item.persona.NombreCompleto
                                            }
                                            else
                                            {

                                                <button onclick="Mostrar(@item.CajaId,'@item.Denominacion');return false;" class="btn waves-effect waves-light ">
                                                    Asignar
                                                    <i class="mdi-content-send right"></i>
                                                </button>

                                            }

                                        </td>

                                        <td id="fechaInicio_@item.CajaId">
                                            @if (item.IndAbierto)
                                            {
                                                @item.FechaInicioOperacion
                                            }


                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>


                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@*<div class="modal fade" id="personal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden=true data-keyboard="false" data-backdrop="static"</div>*@

<div id="modal1" class="modal" aria-hidden=true>
    <form id="formValidate" action='@Url.Action("Guardar","Cajadiario")' method="post">

        <input id="CajaId" name="pCajaId" type="hidden" value="0" />


        <div class="modal-content" style="padding:0">
            <nav class="red">
                <div class="nav-wrapper">
                    <div class="left col s12 m5 l5">
                        <ul>
                            <li>
                                <a href="#!" class="email-menu"><i class="modal-action modal-close  mdi-navigation-close"></i></a>
                            </li>
                            <li>
                                <span id="tituloCaja"></span>
                            </li>

                        </ul>
                    </div>
                    <div class="col s12 m7 l7">
                        <ul class="right">
                            <li>
                                <button type="submit" data-ajax="true" class="btn btn-large btn-flat red white-text " style="vertical-align:baseline;height:auto;"><i class="modal-action mdi-content-save"></i></button>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div class="model-email-content">

            <div class="row">
                <div class="col s12 m8 l12">
                    <div class="input-field col s12">
                        <select name="pPersonaId" value="0">
                            @foreach (var usuario in listaUsuario)
                            {
                                <option value="@usuario.PersonaId">@usuario.persona.NombreCompleto</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">

                <div class="input-field col s12 m8 l6">
                    <p>

                        <label>
                            <span id="mensajeBoveda"></span>
                        </label>

                    </p>

                </div>


                <div id="mostrarSaldo" class="input-field col s12 m8 l6">
                    @*<i class="mdi-editor-attach-money prefix"></i>
                    <label for="txtSaldoInicial" class="" data-error="Ingrese monto correcto">Monto Inicial</label>

                    <input id="txtSaldoInicial" name="SaldoInicial" type="number" data-error=".errorTxt1" class="required number" max="0">
                    <div class="errorTxt1"></div>*@

                </div>

            </div>
        </div>
    </form>
</div>


@section scripts{
    <script>


        $(function () {

            $('.modal-add').leanModal({
                ready: function () {
                    $("#txtSaldoInicial").focus();

                }
            });


        });

        $("#formValidate").validate({
            errorElement: 'div',
            errorPlacement: function (error, element) {
                var placement = $(element).data('error');
                if (placement) {
                    $(placement).append(error)
                } else {
                    error.insertAfter(element);
                }
            }
        });

        function Mostrar(cajaId, CajaName) {

            $.get('@Url.Action("ObtenerSaldoBoveda", "Cajadiario")', function (d) {
                $("#mensajeBoveda").text('En la bóveda hay un saldo de S/. ' + d);
                //$("#txtSaldoInicial").addClass('max');
                //$("#txtSaldoInicial").data('max', d);
                //$("#txtSaldoInicial").css('max', d);
                //$("[max]").css('max', d);

                $("#mostrarSaldo").html('<i class="mdi-editor-attach-money prefix"> </i> <label for="txtSaldoInicial" class="" data-error="Ingrese monto correcto">Monto Inicial </label> <input id="txtSaldoInicial" name="SaldoInicial" type="number" data-error=".errorTxt1" class="required number" max="' + d + '"> <div class="errorTxt1"></div>')
            });

            $('#modal1').openModal();
            $("#CajaId").val(cajaId);
            $("#tituloCaja").text(CajaName);
            $('#txtSaldoInicial').empty();
        }



        function RefreshRowOf(id, persona, fechaInicio) {
            $("#estado_" + id).text('Abierto');
            $("#persona_" + id).text(persona);
            $("#fechaInicio_" + id).text(fechaInicio);
            $('#modal1').closeModal();

        }



    </script>
}      